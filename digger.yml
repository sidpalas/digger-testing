generate_projects:
  blocks:
    - include: "live/staging/**"
      exclude: "**/.terraform/**"
      root_dir: "live"
      terragrunt: true
      workflow: default
      terragrunt_parsing:
        defaultApplyRequirements: [undiverged]

    - include: "live/prod/**"
      exclude: "**/.terraform/**"
      root_dir: "live"
      terragrunt: true
      workflow: default
      terragrunt_parsing:
        defaultApplyRequirements: [mergeable, undiverged, approved]

workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - init
        - apply
    workflow_configuration:
      on_pull_request_pushed: ["digger plan"]
      on_pull_request_closed: ["digger unlock"]
      on_commit_to_default: ["digger unlock"]
