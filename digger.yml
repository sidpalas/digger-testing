generate_projects:
  blocks:
    - block_name: staging
      root_dir: "live/staging"
      terragrunt: true
      workflow: default
      terragrunt_parsing:
        defaultApplyRequirements: [undiverged]

    - block_name: prod
      root_dir: "live/prod"
      terragrunt: true
      workflow: default
      terragrunt_parsing:
        defaultApplyRequirements: [mergeable, undiverged, approved]

workflows:
  default:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - init
        - apply
    workflow_configuration:
      on_pull_request_pushed: ["digger plan"]
      on_pull_request_closed: ["digger unlock"]
      on_commit_to_default: ["digger unlock"]
